<div *ngIf="step"
     class="flow-view-step">

  <ng-template #addDatamapper>
    <div class="alert alert-warning">
      <button type="button"
        (click)="hideAddDatamapperInfo()"
        class="close">
        <span class="pficon pficon-close"></span>
      </button>
      <span class="pficon pficon-warning-triangle-o"></span>
      <p><strong>Data Type Mismatch:</strong> Add a data mapping step before this connection to resolve the difference.</p>
    </div>
  </ng-template>

  <ng-template #tooltipPopover>
    <div>
      <i class="fa fa-remove pull-right" (click)="hideInfoPopover()"></i>

      <!-- TODO Apply UXD outcome - https://github.com/syndesisio/syndesis/issues/700 -->
      <!--
      <div *ngIf="previousStepShouldDefineDataShape"><p style="color:red"><b>Define a data type</b></p></div>
      <div *ngIf="shouldAddDatamapper"><p style="color:red"><b>Add a datamapper step</b></p></div>
      -->
        <dl class="dl-horizontal">
          <dt>
            Name
          </dt>
          <dd>
            {{ step.connection?.name }}
          </dd>
        </dl>
        <dl class="dl-horizontal">
          <dt>
            Action
          </dt>
          <dd>
            {{ step.action?.name }}
          </dd>
        </dl>
        <dl class="dl-horizontal" *ngIf="inputDataShapeText">
          <dt>
            Input Data Type
          </dt>
          <dd>
            {{ inputDataShapeText }}
          </dd>
        </dl>
        <dl class="dl-horizontal" *ngIf="outputDataShapeText">
          <dt>
            Output Data Type
          </dt>
          <dd>
            {{ outputDataShapeText }}
          </dd>
        </dl>
    </div>
  </ng-template>

  <!-- Icon Progress Line -->
  <div class="col-md-3 progress-line">
    <div [ngClass]="'icon ' + getParentActiveClass() + ' ' + getMenuCompleteClass() + ' ' + getConnectionClass()">
      <span>{{ stepIndex }}</span>
      <i [class]="getIconClass()"
         *ngIf="step.stepKind === 'endpoint' && !step.connection"></i>
      <img class="syn-icon-small"
           *ngIf="step.stepKind === 'endpoint' && step.connection"
           [src]="step.connection | synIconPath">
    </div>
  </div>

  <!-- Step Item Wrapper -->
  <div class="col-md-9 menu"
       *ngIf="currentStepKind !== 'mapper'"
       [ngSwitch]="step.stepKind">

    <!-- Connection Steps -->
    <div *ngSwitchCase="'endpoint'"
         [ngClass]="getParentActiveClass() + ' step-container'">

      <!-- Connection Title -->
      <div [ngClass]="getParentClass()"
            (click)="goto('action-configure')">
        <span class="pficon pficon-warning-triangle-o"
          *ngIf="shouldAddDatamapper"
          [popover]="addDatamapper"
          #datamapperInfoPop="bs-popover"
          triggers=""
          placement="right"
          (click)="toggleAddDatamapperInfo(); $event.stopPropagation();"
          container="body"></span>
        {{ stepName }}

        <!-- Delete Icon -->
        <i *ngIf="showDelete()"
          class="fa fa-lg fa-trash pull-right"
          title="Delete this connection"
          (click)="deletePrompt(); $event.stopPropagation();"></i>

        <!-- Info icon -->
        <i class="fa fa-lg fa-info-circle pull-right"
          [popover]="tooltipPopover"
          #connectionInfoPop="bs-popover"
          placement="right"
          (click)="toggleInfoPopover(); $event.stopPropagation();"
          triggers=""
          container="body"></i>
      </div>

      <!-- Connection Sub Pages -->
      <ul [collapse]="isCollapsed()"
          class="sub-steps">
        <li *ngIf="!step.connection"
            [ngClass]="getSubMenuActiveClass('connection-select')"
            (click)="goto('connection-select')">
          <span [ngClass]="getTextClass('connection-select')">Choose a connection</span>
        </li>
        <li *ngIf="step.connection && !step.action"
            [ngClass]="getSubMenuActiveClass('action-select')"
            (click)="goto('action-select')">
          <span [ngClass]="getTextClass('action-select')">Choose an action</span>
        </li>
        <ng-container *ngIf="step.action && currentState === 'action-configure'">
          <ng-template ngFor
                       let-definition
                       [ngForOf]="getPropertyDefinitions(step.action)"
                       let-page="index">
            <li [ngClass]="getSubMenuActiveClass('action-configure', page)"
                (click)="goto('action-configure', page)">
              <span [ngClass]="getTextClass('action-configure', page)">{{ definition.name | capitalize }}</span>
            </li>
          </ng-template>
        </ng-container>
        <ng-container *ngIf="step.action && currentState === 'describe-data'">
          <li [ngClass]="getSubMenuActiveClass('describe-data')">
            <span [ngClass]="getTextClass('describe-data')">Specify Data Type</span>
          </li>
        </ng-container>
      </ul>

    </div>

    <!-- Default Steps -->
    <div *ngSwitchDefault
         [ngClass]="getParentActiveClass() + ' step-container'">

      <!-- Step Heading -->
      <div [ngClass]="getParentClass()"
            (click)="goto('step-configure')">
        {{ stepName }}

        <!-- Delete Icon -->
        <i *ngIf="showDelete()"
          class="fa fa-lg fa-trash pull-right"
          title="Delete this step"
          [class.add-step-or-connection]="step.stepKind !== 'endpoint'"
          (click)="deletePrompt(); $event.stopPropagation();"></i>
      </div>

      <!-- Step Sub Pages -->
      <ul [collapse]="isCollapsed()"
          class="sub-steps">
        <li *ngIf="!step.stepKind"
            [ngClass]="getSubMenuActiveClass('step-select')"
            (click)="goto('step-select')">
          <span [ngClass]="getTextClass('step-select')">Choose a step</span>
        </li>
        <li *ngIf="step.stepKind && !step.configuredProperties"
            [ngClass]="getSubMenuActiveClass('step-configure')"
            (click)="goto('step-configure')">
          <span [ngClass]="getTextClass('step-configure')">Configure the step</span>
        </li>
        <li *ngIf="step.configuredProperties"
            [ngClass]="getSubMenuActiveClass('step-configure')"
            (click)="goto('step-configure')">
          <span [ngClass]="getTextClass('step-configure')">Configuration</span>
        </li>
      </ul>
    </div>

  </div>
</div>
